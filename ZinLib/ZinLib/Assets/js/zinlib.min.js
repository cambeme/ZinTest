function GetItem(n,t){var i=db.getCollection(n),r;i===null?(r={id:"root",text:"Chưa có dữ liệu",type:"root"},$("#tree"+n).jstree("create_node",null,r,"first")):($("#tree"+n).jstree("delete_node",$("#tree"+n).jstree().get_json()),$.each(i.find(),function(i,r){var u=TextGenerator(t,r),f={id:r.$loki,text:u,type:"root"};$("#tree"+n).jstree("create_node",null,f,"last")}))}function SaveAddItem(n,t){var i=db.getCollection(n),r;i===null&&(i=db.addCollection(n));r=$("#"+t+" *").formToJson();try{var u=i.insert(r),f=TextGenerator(t,u),e={id:u.$loki,text:f,type:"root"};$("#tree"+n).jstree("delete_node","root");$("#tree"+n).jstree("create_node",null,e,"last");alertify.success("tl","Thêm mới thành công")}catch(o){alertify.warning("tl",o)}}function EditItem(n,t,i){var r=db.getCollection(n),u=r.findOne({$loki:parseInt(i)});$("#"+t+" *").jsonToForm(u)}function SaveEditItem(n,t,i){var u=db.getCollection(n),r=u.findOne({$loki:parseInt(i)}),e=$("#"+t+" *").formToJson(),f;$.each(r,function(n){n!=="meta"&&n!=="$loki"&&(r[n]=e[n])});try{u.update(r);f=TextGenerator(t,r);$("#tree"+n).jstree("rename_node",r.$loki,f);alertify.success("tl","Chỉnh sửa thành công")}catch(o){alertify.warning("tl",o)}}function SaveRemoveItem(n,t,i){var r=db.getCollection(n),u=r.findOne({$loki:parseInt(i)});try{r.remove(u);$("#tree"+n).jstree("delete_node",i);alertify.success("tl","Xóa thành công")}catch(f){alertify.warning("tl",f)}}function TextGenerator(n,t){var u=$("#"+n+" *").formToJson(),i=[],r;return $.each(u,function(t){var r=$("#"+n).find("[name='"+t+"']").prop("id"),u=$("#"+n).find("label[for='"+r+"']").text();i.push({id:r,name:t,label:u})}),r="",$.each(i,function(n){r+=n===i.length-1?i[n].label+": "+t[i[n].name]:i[n].label+": "+t[i[n].name]+", "}),r}function OnLoadTreeAndSelect(n,t,i,r,u){$("#"+n).jstree().deselect_all();$("#"+n).jstree("select_node","#"+u+"");$("#"+n).jstree("disable_node","#"+r);TreeAndSelectData.push({id:r,text:$("#"+n).jstree("get_text","#"+r)});var f=$("#"+n).jstree("get_node","#"+r).children_d;$.each(f,function(t,i){$("#"+n).jstree("disable_node","#"+i);TreeAndSelectData.push({id:i,text:$("#"+n).jstree("get_text","#"+i)})});$.each(TreeAndSelectData,function(n,i){$("#"+t+" option[value='"+i.id+"']").remove()});u>0?$("#"+t).val(u).change():$("#"+t).val(0).change()}function OnUnloadTreeAndSelect(n,t,i){$("#"+n).jstree("enable_node","#"+i);var r=$("#"+n).jstree("get_node","#"+i).children_d;$.each(r,function(t,i){$("#"+n).jstree("enable_node","#"+i)});i>0&&$.each(TreeAndSelectData,function(n,i){var r=new Option(i.text,i.id);$("#"+t).append(r)});TreeAndSelectData=[]}function ResetChildrenByType(n){for(var t,i=0;i<n.childNodes.length;i++)if(t=n.childNodes[i],t.tagName)switch(t.tagName.toLowerCase()){case"input":switch(t.type){case"radio":case"checkbox":t.checked=!1;break;case"button":case"submit":case"image":break;default:t.value=""}break;case"select":t.selectedIndex=0;break;case"textarea":t.value="";break;default:ResetChildrenByType(t)}}function ResetChildrenSelect2ById(n){$("#"+n).val("0").change()}function centerModal(){$(".modal.in").each(function(){var n=$(this).find(".modal-dialog.modal-center"),t=($(window).height()-n.height())/2,i=parseInt(n.css("marginBottom"),10);t<i&&(t=i);n.css("margin-top",t)})}function loading(n){n?$("html").loadingModal({position:"auto",text:"Đang xử lý...",color:"#fff",opacity:"0.7",backgroundColor:"rgb(0,0,0)",animation:"fadingCircle"}):$("html").loadingModal("destroy")}function OnError(n,t,i){loading(!1);var r,u="";try{r=jQuery.parseJSON(n.responseText);u+="<div><div><b>"+t+" "+i+"<\/b><\/div>";u+="<div><u>Exception<\/u>:<br /><br />"+r.ExceptionType+"<\/div>";u+="<div><u>StackTrace<\/u>:<br /><br />"+r.StackTrace+"<\/div>";u+="<div><u>Message<\/u>:<br /><br />"+r.Message+"<\/div><\/div>"}catch(f){r=n.responseText;u=r}Lobibox.alert("error",{title:"Lỗi",msg:u})}function DateTimeConvert(n,t){var o=$.extend({time:!1},t),i,r=["1","2","3","4","5","6","7","8","9","10","11","12"];i=Object.prototype.toString.call(n)==="[object String]"?new Date(parseInt(n)):new Date(n);var u=i.getMonth(),f=i.getHours(),e=i.getMinutes();return""+(o.time?i.getDate()+"/"+r[u]+"/"+i.getFullYear()+" "+(f<10?"0":"")+f+":"+(e<10?"0":"")+e:i.getDate()+"/"+r[u]+"/"+i.getFullYear())}function GetDefaultDate(n){return $.datepicker.formatDate("dd/mm/yy",$(n).datepicker("getDate"))}function ToggleSearchResult(n,t){n&&(t<1?($("#dvKetQuaTimKiemEmpty").css({display:"block"}),$("#dvKetQuaTimKiem").css({visibility:"hidden"})):($("#dvKetQuaTimKiemEmpty").css({display:"none"}),$("#dvKetQuaTimKiem").css({visibility:"visible"})));CustomSearch=!1}function Confirm(n,t){$.confirm({title:"Xác nhận",text:n,confirmButton:"Đồng ý",cancelButton:"Thoát",confirm:function(){t()},cancel:function(){}})}function AddCommas(n){n+="";for(var i=n.split("."),t=i[0],u=i.length>1?"."+i[1]:"",r=/(\d+)(\d{3})/;r.test(t);)t=t.replace(r,"$1,$2");return t+u}function SetContentTinymce(n,t){tinymce.get(n).setContent(t)}function GetContentTinymce(n){return tinymce.get(n).getContent({format:"raw"})}function DomToVar(n){return encodedHtml=escape(n),encodedHtml=encodedHtml.replace(/\//g,"%2F"),encodedHtml=encodedHtml.replace(/\?/g,"%3F"),encodedHtml=encodedHtml.replace(/=/g,"%3D"),encodedHtml=encodedHtml.replace(/&/g,"%26"),encodedHtml=encodedHtml.replace(/@@/g,"%40")}function ArrNoDupe(n){for(var i={},t=0;t<n.length;t++)i[n[t]]=!0;return Object.keys(i)}function ArrMulNoDupe(n){for(var i=[],r=[],t=0;t<n.length;t++)i[n[t].id]||(i[n[t].id]=!0,r.push(n[t]));return r}function ConvertToObj(n){var t={},i,r;if(typeof n=="object")for(i in n)r=ConvertToObj(n[i]),t[i]=r;else t=n;return t}var $linkRoot=window.location.protocol+"//"+location.host,pgurl=window.location.href.substr(window.location.href.lastIndexOf("/")+1),DynamicSelect2,CustomSearch=!1,TreeAndSelectData=[],modal,alertify;$(function(){$(".modal").appendTo($("#dvModalContainer"));$("#dvModalContainer .modal").each(function(){$("[id='"+this.id+"']:gt(0)").remove()});$(".dataTables_filter").length?$(".CreateButton").insertBefore(".dataTables_filter"):$(".btn-top-table").length&&($(".dataTables_length").css({"text-align":"left"}),$(".btn-top-table").appendTo($(".dataTables_length").parent().siblings(".col-md-6")))});modal=function(){return{add:function(n,t){ResetChildrenByType(document.getElementById(n));ResetChildrenSelect2ById(n);$("#"+n+"").removeClass().addClass("modal Add");$("#"+n+"").find(".panel-body > div.row > div:first-child").show();$("#"+n+"").find(".panel-body > div.row > div:last-child").hide();$("#"+n+"").find(".panel").removeClass().addClass("panel panel-primary");$("#"+n+"").find(".panel-title > span").text("Thêm "+t+"");$("#"+n+"").find(".panel-footer .pull-right > a:first-child").html("<i class='fa fa-plus'><\/i> Lưu").removeClass().addClass("btn btn-primary hover-effect BindButton").show();$("#"+n+"").find(".panel-footer .pull-right > a:nth-child(2)").hide()},edit:function(n,t){$("#"+n+"").removeClass().addClass("modal Edit");$("#"+n+"").find(".panel-body > div.row > div:first-child").show();$("#"+n+"").find(".panel-body > div.row > div:last-child").hide();$("#"+n+"").find(".panel").removeClass().addClass("panel panel-success");$("#"+n+"").find(".panel-title > span").text("Sửa "+t+"");$("#"+n+"").find(".panel-footer .pull-right > a:first-child").html("<i class='fa fa-edit'><\/i> Cập nhật").removeClass().addClass("btn btn-success hover-effect BindButton").show();$("#"+n+"").find(".panel-footer .pull-right > a:nth-child(2)").hide()},remove:function(n,t){$("#"+n+"").removeClass().addClass("modal Remove");$("#"+n+"").find(".panel-body > div.row > div:first-child").hide();$("#"+n+"").find(".panel-body > div.row > div:last-child").html("<h4><b>Bạn chắc chắn muốn xóa "+t+" này?<\/b><\/h4>").show();$("#"+n+"").find(".panel").removeClass().addClass("panel panel-danger");$("#"+n+"").find(".panel-title > span").text("Xóa "+t+"");$("#"+n+"").find(".panel-footer .pull-right > a:first-child").hide();$("#"+n+"").find(".panel-footer .pull-right > a:nth-child(2)").html("<i class='fa fa-trash-o'><\/i> Đồng ý").removeClass().addClass("btn btn-danger hover-effect BindButton").show()}}}();alertify=function(){function n(n,t,i){var r="";switch(n){case"default":r="Thông báo";break;case"info":r="Thông tin";break;case"warning":r="Cảnh báo";break;case"error":r="Thất bại";break;case"success":r="Thành công"}switch(t){case"tc":t="top center";break;case"tl":t="top left";break;case"tr":t="top right";break;case"bl":t="bottom left";break;case"br":t="bottom right"}Lobibox.notify(n,{sound:!1,delayIndicator:!0,position:t,title:r,msg:i,messageHeight:"auto"}).$el.css("word-wrap","break-word")}function t(n,t,i){Lobibox.confirm({title:"Xác nhận",msg:n,callback:function(n,r){if(r==="yes")typeof t=="function"&&t.call(this);else if(r==="no")if(i)typeof i=="function"&&i.call(this);else return!1}})}return{"default":function(t,i){n("default",t,i)},info:function(t,i){n("info",t,i)},warning:function(t,i){n("warning",t,i)},error:function(t,i){n("error",t,i)},success:function(t,i){n("success",t,i)},confirm:function(n,i,r){t(n,i,r)}}}(),function(n){n.fn.collectData=function(t){for(var e,o,f=n.extend({stringify:!1,object:!1},t),r=this.selector.split(", "),i=n(r[0]).getSavedData(),u=1;u<r.length;u++)e=r[u],o=n(r[u]).getSavedData(),i[e]=o;return f.object?f.stringify?JSON.stringify(ConvertToObj(i)):ConvertToObj(i):f.stringify?JSON.stringify(i):i};n.fn.getSavedData=function(t){var r=n.extend({stringify:!1,object:!1},t),u=db.getCollection(this.selector),f=u.find(),i=[];return n.each(f,function(n,t){delete t.$loki;delete t.meta;i.push(t)}),r.object?r.stringify?JSON.stringify(ConvertToObj(i)):ConvertToObj(i):r.stringify?JSON.stringify(i):i};n.fn.formToJson=function(t,i){var f=n.extend({stringify:!1},t),u={},e=this.serializeArray({checkboxesAsBools:!0}),r;return n.each(e,function(){r=this;n.isFunction(i)&&(r=i(r.name,r.value));u[this.name]!==undefined?(u[r.name].push||(u[r.name]=[u[r.name]]),u[r.name].push(r.value||"")):u[r.name]=r.value||""}),f.stringify?JSON.stringify(u):u};n.fn.serializeArray=function(t){var i=n.extend({checkboxesAsBools:!1},t||{}),r=/select|textarea/i,u=/text|hidden|password|search/i;return this.map(function(){return this.elements?n.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||i.checkboxesAsBools&&this.type==="checkbox"||r.test(this.nodeName)||u.test(this.type))}).map(function(t,r){var u=n(this).val();return u===null?null:n.isArray(u)?n.map(u,function(n){return{name:r.name,value:n}}):{name:r.name,value:i.checkboxesAsBools&&this.type==="checkbox"?this.checked?"true":"false":u}}).get()};n.fn.jsonToForm=function(t){typeof t=="string"&&(t=JSON.parse(t));n.each(this.find("*[name]"),function(){var r=n(this).attr("type"),i=t[n(this).attr("name")];r==="radio"||r==="checkbox"?n.isArray(i)?n(this).prop("checked",n.inArray(n(this).val(),i)>-1):n(this).prop("checked",i==="true"):n(this).val(i)})};n.fn.confirm=function(t){return typeof t=="undefined"&&(t={}),this.click(function(i){i.preventDefault();var r=n.extend({button:n(this)},t);n.confirm(r,i)}),this};n.confirm=function(t,i){var f,s,r,e,o,h,u;if(typeof t=="undefined"){console.error("No options given.");return}if(!(n(".confirmation-modal").length>0)){f={};t.button&&(s={title:"title",text:"text","confirm-button":"confirmButton","submit-form":"submitForm","cancel-button":"cancelButton","confirm-button-class":"confirmButtonClass","cancel-button-class":"cancelButtonClass","dialog-class":"dialogClass","modal-options-backdrop":"modalOptionsBackdrop","modal-options-keyboard":"modalOptionsKeyboard"},n.each(s,function(n,i){var r=t.button.data(n);typeof r!="undefined"&&(f[i]=r)}));r=n.extend({},n.confirm.options,{confirm:function(){var r,u;f.submitForm||typeof f.submitForm=="undefined"&&t.submitForm||typeof f.submitForm=="undefined"&&typeof t.submitForm=="undefined"&&n.confirm.options.submitForm?i.target.closest("form").submit():(r=i&&("string"==typeof i&&i||i.currentTarget&&i.currentTarget.attributes.href.value),r&&(t.post?(u=n("<form method='post' class='hide' action='"+r+"'><\/form>"),n("body").append(u),u.submit()):window.location=r))},cancel:function(){},button:null},t,f);e="";r.title!==""&&(e="<div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;<\/button><h4 class='modal-title'>"+r.title+"<\/h4><\/div>");o="";r.cancelButton&&(o="<button class='cancel btn "+r.cancelButtonClass+"' type='button' data-dismiss='modal'>"+r.cancelButton+"<\/button>");h="<div class='confirmation-modal modal' tabindex='-1' role='dialog'><div class='"+r.dialogClass+"'><div class='modal-content'>"+e+"<div class='modal-body'>"+r.text+"<\/div><div class='modal-footer'><button class='confirm btn "+r.confirmButtonClass+"' type='button' data-dismiss='modal'>"+r.confirmButton+"<\/button>"+o+"<\/div><\/div><\/div><\/div>";u=n(h);(typeof r.modalOptionsBackdrop!="undefined"||typeof r.modalOptionsKeyboard!="undefined")&&u.modal({backdrop:r.modalOptionsBackdrop,keyboard:r.modalOptionsKeyboard});u.on("show.bs.modal",function(){u.find(".btn-primary:first").focus();centerModal()});u.on("hidden.bs.modal",function(){u.remove()});u.find(".confirm").click(function(){r.confirm(r.button)});u.find(".cancel").click(function(){r.cancel(r.button)});n("body").append(u);u.modal("show")}};n.confirm.options={text:"Are you sure?",title:"",confirmButton:"Yes",cancelButton:"Cancel",post:!1,submitForm:!1,confirmButtonClass:"btn-primary",cancelButtonClass:"btn-default",dialogClass:"modal-dialog modal-center",modalOptionsBackdrop:!0,modalOptionsKeyboard:!0}}(jQuery);$(document).on("keypress",function(n){n.keyCode===13&&$(".modal.in").length===0&&($("#dvMain").find("ul.nav-tabs").length===0?$("#dvMain").find(".BindButton").click():$("#dvMain").find(".tab-pane.active").find(".BindButton").click())});$(document).on("show.bs.modal",".modal",function(){var n=1050+10*$(".modal.in").length;$(this).css("z-index",n);DynamicSelect2=n+10;$(".modal.in").each(function(){$(this).css("z-index")<n&&$(this).hide()})});$(document).on("shown.bs.modal",".modal",function(){isAlreadyPressed=!0;centerModal();$(this).append("<input type='text' id='btnAutoFocus' style='opacity:0' />");$(this).find("#btnAutoFocus").focus();$(this).off("keypress").on("keypress",function(n){n.keyCode===13&&($(this).find("ul.nav-tabs").length===0?$(this).find(".BindButton").click():$(this).find(".tab-pane.active").find(".BindButton").click())})});$(document).on("hide.bs.modal",".modal",function(){$(this).find("#btnAutoFocus").remove();var n=0,t=parseInt($(this).css("z-index"),10);t>n&&(n=t);$(".modal.in").each(function(){parseInt($(this).css("z-index"))===n-10?$(this).show():$(this).hide()})});$(document).on("hidden.bs.modal",".modal",function(){$(".modal.in").length===0&&$(".modal").css("z-index","");centerModal()});$("a[data-toggle='tab']").on("shown.bs.tab",function(n){$(n.target).closest(".modal").find("#btnAutoFocus").focus()});$("select").on("select2:open",function(){$("body > span > span.dynamic-select2").css("z-index",DynamicSelect2)});$(window).on("resize",function(){centerModal()});window.tinyMCE&&tinymce.init({selector:".editable",language:"vi_VN",height:200,theme:"modern",plugins:["advlist autolink lists link charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern"],toolbar1:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",toolbar2:"print preview media | forecolor backcolor emoticons",image_advtab:!0,templates:[{title:"Test template 1",content:"Test 1"},{title:"Test template 2",content:"Test 2"}],content_css:["../../Assets/plugins/tinymce/codepen.min.css"],force_br_newlines:!0,force_p_newlines:!1,forced_root_block:!1});Lobibox&&(Lobibox.base.OPTIONS=$.extend({},Lobibox.base.OPTIONS,{buttons:{ok:{"class":"lobibox-btn lobibox-btn-default",text:"OK",closeOnClick:!0},cancel:{"class":"lobibox-btn lobibox-btn-cancel",text:"Đóng",closeOnClick:!0},yes:{"class":"btn btn-primary",text:"Đồng ý",closeOnClick:!0},no:{"class":"btn btn-danger",text:"Hủy",closeOnClick:!0}}}));$.datepicker&&$.datepicker.setDefaults({currentText:"Hiện tại",closeText:"Đóng",autoSize:!1,showButtonPanel:!0,changeMonth:!0,changeYear:!0,prevText:"&#x3C;Trước",nextText:"Tiếp&#x3E;",monthNames:["Tháng Một","Tháng Hai","Tháng Ba","Tháng Tư","Tháng Năm","Tháng Sáu","Tháng Bảy","Tháng Tám","Tháng Chín","Tháng Mười","Tháng Mười Một","Tháng Mười Hai"],monthNamesShort:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayNames:["Chủ Nhật","Thứ Hai","Thứ Ba","Thứ Tư","Thứ Năm","Thứ Sáu","Thứ Bảy"],dayNamesShort:["CN","T2","T3","T4","T5","T6","T7"],dayNamesMin:["CN","T2","T3","T4","T5","T6","T7"],weekHeader:"Tu",dateFormat:"dd/mm/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:"",duration:"fast",hideIfNoPrevNext:!0,numberOfMonths:1,showWeek:!0,yearRange:"1900:2099"});$.timepicker&&$.timepicker.setDefaults({currentText:"Hiện tại",closeText:"Đóng",timeOnlyTitle:"Chọn giờ",timeText:"Thời gian",hourText:"Giờ",minuteText:"Phút",secondText:"Giây",millisecText:"Mili giây",microsecText:"Micrô giây",timezoneText:"Múi giờ",controlType:"select",oneLine:!0,timeInput:!0,timeSuffix:"",amNames:["sáng","S"],pmNames:["chiều","C"],isRTL:!1});$(".datepicker").datepicker();$(".datepicker-from").datepicker({onSelect:function(){$(".datepicker-to").datepicker("option","minDate",$(".datepicker-from").datepicker("getDate"))}});$(".datepicker-to").datepicker({onSelect:function(){$(".datepicker-from").datepicker("option","maxDate",$(".datepicker-to").datepicker("getDate"))}});$().mask&&($(".datepicker").mask("00/00/0000"),$(".money").mask("#,##0",{reverse:!0}),$(".number").mask("#0",{reverse:!0}));$.datepicker._gotoToday=function(n){$(n).datepicker("setDate",new Date).datepicker("hide").blur()};$(".datetimepicker").datetimepicker();$(".datetimepicker-from").datetimepicker({onSelect:function(){$(".datetimepicker-to").datetimepicker("option","minDate",$(".datetimepicker-from").datetimepicker("getDate"))}});$(".datetimepicker-to").datetimepicker({onSelect:function(){$(".datetimepicker-from").datetimepicker("option","maxDate",$(".datetimepicker-to").datetimepicker("getDate"))}});$().select2&&$(".select2").select2({dropdownCssClass:"dynamic-select2",allowClear:!1,width:"100%"});$("table").css({width:"100%"});